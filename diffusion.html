<!DOCTYPE html>
<html>
<head><title>Jim's Chatbot</title></head>
<body style='background:#fff;'>
<h1>Jim's Diffusion</h1>
<label>Models</label>
<select id="modelopts">
<option value="https://api-inference.huggingface.co/models/digiplay/DreamShaper_7">DreamShaper</option>
<option value="https://api-inference.huggingface.co/models/stablediffusionapi/toonyou">ToonYou</option>
<option value="https://api-inference.huggingface.co/models/redstonehero/m4rv3ls-and-dungeons-v10">m4rv3ls-and-dungeons-v10</option>
<option value="https://api-inference.huggingface.co/models/kohbanye/pixel-art-style">Pixel Art</option>
<option value="https://api-inference.huggingface.co/models/stablediffusionapi/t-shirt-diffusion">t-shirt-diffusion</option>
<option value="https://api-inference.huggingface.co/models/Ojimi/anime-kawai-diffusion">anime-kawai-diffusion</option>
<option value="https://api-inference.huggingface.co/models/emilianJR/XXMix_9realistic">XXMix_9realistic</option>
	





</select>
<textarea id="imageq" style="width:100%; height:50px;" placeholder='Prompt: type something to generate images'></textarea><br>
<textarea id="neg_imageq" style="width:100%; height:50px;" placeholder='Negative-Prompt: type something'>blurry</textarea>
	
<button onclick="genimg_process()">Generate Image</button>
<button onclick="llm_process()">Just talk</button>
<div id="my-div" style="width:100%;">Wait for it...
<img style="width:100%;">
</div>
</body>
</html>
<script>

document.body.oncontextmenu = function(event) {
  event.preventDefault();
  return false;
};

    async function query(data) {
   // let defaultmodel = "https://api-inference.huggingface.co/models/digiplay/DreamShaper_7";   
    let defaultmodel=document.querySelector('#modelopts').value;    
	const response = await fetch(
		defaultmodel,
		{
			headers: { Authorization: "Bearer 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" },
			method: "POST",
			body: JSON.stringify(data),
		}
	);
	const result = await response.blob();
	return result;
}
	//"masterpiece, (photorealistic:1.4), best quality, beautiful lighting, (ulzzang-6500:0.5), lucy \(cyberpunk\), 1girl, white hair, against railing, arm rest, bangs, bare shoulders, belt, black belt, black leotard, black pants, blurry, bob cut, breasts, building, cityscape, clothing cutout, (cropped jacket), cyberpunk, depth of field, from side, gradient eyes, grey eyes, grey hair, white jacket, leotard, lips, long sleeves, looking afar, looking ahead, (mechanical parts), medium breasts, multicolored eyes, multicolored hair, night, night sky, off shoulder, open clothes, open jacket, outdoors, pants, parted lips, railing, red eyeliner, science fiction, short hair with long locks, short shorts, shorts, sidelocks, sky, solo, standing, teeth, thigh cutout, upper teeth only, white jacket, white shorts, cyberpunk \(series\), cyberpunk edgerunners, RAW photo, 8k uhd, film grain, cosplay, white wig, night, neon lights,,,, <lora:lucy_offset:1.21>"
	
	query({
		"inputs": "generate image",
		"parameters": {
    			"negative_prompt": 'blurry',
  		}
	}).then((response) => {
	convertBlobToBase64(response);
});


function genimg_process(){
    speak("Initiating Artwork Sequence, Please wait");   
var q=document.querySelector('#imageq').value;
var neg_q=document.querySelector('#neg_imageq').value;	

var defpromp="masterpiece, best quality,";
    query({
	    "inputs": defpromp+""+q,
	    "parameters": {
    			"negative_prompt": ''+neg_q,
  		}
    }).then((response) => {
	convertBlobToBase64(response);
});


}


function convertBlobToBase64(blob) {
  const reader = new FileReader();
  reader.onloadend = () => {
    const base64String = reader.result;
    console.log(base64String);

    const image = document.querySelector('img');
image.src = base64String+"";





  };
  reader.readAsDataURL(blob);
}





function speak(text, callback) {
    var u = new SpeechSynthesisUtterance();
    u.text = text;
    u.lang = 'en-UK';
 
    u.onend = function () {
        if (callback) {
            callback();
        }
    };
 
    u.onerror = function (e) {
        if (callback) {
            callback(e);
        }
    };
 
    speechSynthesis.speak(u);
}



async function text_query(filename) {

 const response = await fetch(
    "https://api-inference.huggingface.co/models/nlpconnect/vit-gpt2-image-captioning",
    {
      headers: { Authorization: "Bearer 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" },
      method: "POST",
      body: await getFileData(filename),
    }
  );
  const result = await response.json();
  return result;
	
	
	/*
const data = fs.readFileSync(filename);
	const response = await fetch(
		"https://api-inference.huggingface.co/models/nlpconnect/vit-gpt2-image-captioning",
		{
			headers: { Authorization: "Bearer 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" },
			method: "POST",
			body: data,
		}
	);
	const result = await response.json();
	return result;
*/	
	
}


function getFileData(filename) {
  return new Promise((resolve, reject) => {
    const fileReader = new FileReader();
    fileReader.onload = (event) => {
      resolve(event.target.result);
    };
    fileReader.onerror = (error) => {
      reject(error);
    };
    const fileInput = document.createElement('input');
    fileInput.type = 'file';
    fileInput.accept = 'image/*'; // Specify the accepted file types
    fileInput.onchange = () => {
      const file = fileInput.files[0];
      fileReader.readAsDataURL(file);
    };
    fileInput.click();
  });
}

	
async function llm_process(){

const image = document.querySelector('img');
	
	
text_query(image.src+"").then((response) => {
	console.log(JSON.stringify(response));
});
    
    //speak("Let's make Art Epic")
}

</script>



